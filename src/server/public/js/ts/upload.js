"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};exports.__esModule=!0,document.addEventListener("DOMContentLoaded",fn,!1);var Uppy=require("@uppy/core"),Dashboard=require("@uppy/dashboard"),Tus=require("@uppy/tus");function fn(){var e=Uppy({restrictions:{allowedFileTypes:["image/*"]},onBeforeUpload:function(o){var r={};return Object.keys(o).forEach(function(e){r[e]=__assign({},o[e]);var t,n=s();for(t in n)r[e].meta[t]=n[t]}),r},debug:!0});window.uppy=e,console.log("Uppy loaded"),e.use(Dashboard,{inline:!0,fileManagerSelectionType:"both",target:".upload-box",proudlyDisplayPoweredByUppy:!0,showLinkToFileUploadResult:!0,showProgressDetails:!0}).use(Tus,{endpoint:"/upload_resumable",limit:10});var n,s=function(){var e,e=(t=(e="progress")+o++,(e=document.createElement("div")).id=t,document.querySelector("#progress").appendChild(e),t),t=new Nanobar({bg:"#44f",target:document.getElementById(e)});return r[e]=t,{progressID:e,userID:n}},o=0,r={};var t=io.connect("http://"+document.domain+":"+location.port+"/events");t.on("connect",function(){t.emit("status",{status:"I'm connected!"})}),t.on("userid",function(e){n=e.userid}),t.on("updatestatus",function(e){var t,n=100*e.current/e.total;r[e.elementid].go(n),console.log(e,"updateprogess"),"DONE"==e.status&&(t=document.getElementById(e.elementid).parentElement,(n=document.createElement("a")).href="/view?img="+e.filename,n.text="open image",t.appendChild(n))}),t.on("status",function(e){console.log(e,"status")}),t.on("disconnect",function(e){console.log(e,"dead server")})}