function fn(){var o="",e=document.querySelector("button"),c=document.querySelector("input");e.onclick=function(){n()};var d,n=function(){var e=c.files,n=new FormData;n.append("file",e[0]),n.append("userid",d),o=e[0].name;var t,t=(e=(t="progress")+r++,(t=document.createElement("div")).id=e,document.querySelector("#progress").appendChild(t),e);n.append("elementid",t);e=new Nanobar({bg:"#44f",target:document.getElementById(t)});u[t]=e,fetch("/upload",{method:"POST",body:n}).then(function(e){return e.json()}).then(function(e){console.log(e)}).catch(function(e){console.error(e)})},r=0,u={};var t=io.connect("http://"+document.domain+":"+location.port+"/events");t.on("connect",function(){t.emit("status",{status:"I'm connected!"})}),t.on("userid",function(e){d=e.userid}),t.on("celerystatus",function(e){var n=100*e.current/e.total;u[e.elementid].go(n),console.log(e,"updateprogess"),"DONE"==e.status&&(n=document.getElementById(e.elementid).parentElement,(e=document.createElement("a")).href="/?img="+o,e.text="open image",n.appendChild(e))}),t.on("status",function(e){console.log(e,"status")}),t.on("disconnect",function(e){console.log(e,"dead server")})}document.addEventListener("DOMContentLoaded",fn,!1);